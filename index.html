<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Iron FX Client Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --rojo: #c00000;
      --rojo-hover: #a10000;
      --azul: #2876c8;
      --azul-hover: #1d538e;
      --azul-titulo: #2876c8;
      --negro: #10131a;
      --negro2: #171c23;
      --blanco: #fff;
      --gris-claro: #f5f5f5;
      --gris-medio: #e0e0e0;
      --gris-oscuro: #21242e;
      --verde: #1ecb5b;
      --verde-btn: #18b94a;
      --verde-btn-hover: #128c37;
      --verde-msg: #128c37;
      --azul-btn: #2876c8;
      --azul-btn-hover: #1d538e;
      --borde: #e0e0e0;
      --borde-rojo: #c00000;
      --borde-azul: #2876c8;
      --font: 'Inter', Arial, sans-serif;
      --shadow: 0 6px 32px #000a, 0 1.5px 5px #0003;
    }
    html, body {
      background: var(--negro);
      color: var(--negro);
      font-family: var(--font);
      margin: 0; padding: 0; min-height: 100vh;
    }
    body {
      background: var(--negro);
    }
    .main-wrap {
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      justify-content: flex-start;
      width: 100vw;
    }
    .login-panel {
      background: var(--gris-claro);
      color: var(--negro);
      box-shadow: var(--shadow);
      border-radius: 18px;
      max-width: 400px;
      margin: 60px auto 0 auto;
      padding: 40px 30px 32px 30px;
      border: 1.5px solid var(--borde);
      position: relative;
      transition: border-color .2s, box-shadow .2s;
    }
    h1 {
      text-align: center;
      color: var(--rojo);
      letter-spacing: 2px;
      font-weight: 900;
      font-size: 2.1em;
      margin-bottom: 20px; margin-top: 0;
      text-shadow: 0 2px 10px #c0000040;
      transition: color .25s;
    }
    .login-panel label {
      margin-top: 13px; font-weight: 600; color: var(--gris-oscuro);
    }
    .login-panel input {
      width: 100%; padding: 12px; margin: 8px 0 0 0; border-radius: 8px;
      border: 1.2px solid var(--gris-medio); background: var(--gris-medio); color: var(--negro);
      font-size: 1.1em; font-family: var(--font);
      transition: box-shadow .18s, border .18s;
    }
    .login-panel input:focus { outline:none; border:1.5px solid var(--rojo); box-shadow:0 0 0 2px #c0000033;}
    .login-panel button {
      width:100%; padding:13px; border-radius:9px; border:none;
      background: linear-gradient(90deg, var(--azul-btn) 60%, var(--azul-btn-hover));
      color: #fff; font-weight: 700; font-size: 1.2em; margin: 26px 0 0 0;
      letter-spacing: 1.5px; cursor:pointer; transition: background .16s, box-shadow .16s;
      box-shadow: 0 2px 10px #0006;
    }
    .login-panel button:hover { background:linear-gradient(90deg,var(--azul-btn-hover) 40%,var(--azul-btn) 120%);}
    .header-bar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 18px 28px 16px 28px;
      background: var(--gris-claro);
      border-radius: 0 0 16px 16px;
      box-shadow: 0 6px 16px #0001;
      width: 100%;
      max-width: 1100px;
      margin: 0 auto 10px auto;
      border-bottom: 2px solid var(--gris-medio);
      transition: border-bottom .2s;
    }
    .header-bar .user {
      font-weight: 900;
      color: var(--rojo);
      font-size: 1.13em;
      transition: color .3s;
    }
    .header-bar .balance {
      font-size: 1.09em; font-weight: 700; background: var(--gris-claro); color: var(--negro);
      padding: 7px 18px; border-radius: 9px; border: 1.2px solid var(--rojo);
      margin-left: 9px; font-variant-numeric: tabular-nums;
      box-shadow: 0 2px 8px #0002;
      letter-spacing: 1px;
      font-family: var(--font);
      transition: border-color .2s;
    }
    .logout-btn {
      background: none;
      border: none;
      color: var(--rojo);
      font-weight: 700;
      font-size: 1em;
      margin-left: 20px;
      cursor: pointer;
      letter-spacing: 1px;
      text-shadow: 0 1px 4px #0002;
      transition: color 0.15s;
    }
    .logout-btn:hover { color: var(--negro); }
    .nav-main { display: none; }
    .bottom-nav {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: var(--gris-claro);
      box-shadow: 0 -2px 14px #0004;
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 54px;
      z-index: 999;
      border-radius: 16px 16px 0 0;
      border-top: 2px solid var(--rojo);
      width: 100vw;
      max-width: 100vw;
      transition: border-top .2s;
    }
    .bottom-nav-btn {
      flex: 1;
      background: none;
      border: none;
      color: var(--gris-oscuro);
      font-size: 1.09em;
      font-weight: 700;
      letter-spacing: 1px;
      padding: 7px 0 0 0;
      cursor: pointer;
      outline: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background .15s, color .15s;
      border-radius: 12px;
      height: 100%;
      border: none;
      position: relative;
    }
    .bottom-nav-btn.active,
    .bottom-nav-btn:focus {
      color: var(--rojo);
      background: var(--gris-medio);
    }
    .bottom-nav-btn span {
      font-size: 1.5em;
      display: block;
      margin-bottom: 1px;
      transition: color .2s;
    }
    .panel-section { display: none; }
    .panel-section.active { display: block; }
    .panel-content {
      margin: 0 auto;
      max-width: 1100px;
      background: var(--gris-claro);
      border-radius: 15px;
      box-shadow: 0 1px 7px #0001;
      padding: 26px 12px 20px 12px;
      margin-bottom: 18px;
      border: 2px solid var(--borde);
      position: relative;
      transition: border-color .25s, box-shadow .25s;
    }
    .panel-content::before {
      content: "";
      position: absolute;
      top: -2px; left: 10px; right: 10px; height: 0;
      border-top: 4px solid var(--rojo);
      border-radius: 8px 8px 0 0;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s;
    }
    .panel-title {
      font-size: 1.23em;
      font-weight: 900;
      color: var(--rojo);
      margin-bottom: 18px;
      text-align:center;
      letter-spacing: 1.3px;
      transition: color .3s;
    }
    .tvcharts-flex {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
      justify-items: stretch;
      margin-bottom: 18px;
    }
    .tvcharts-flex > div {
      width: 100%;
    }
    .tradingview-widget-container {
      width: 100% !important;
    }
    /* NUEVO: Nombres de activos sobre las gr√°ficas */
    .asset-label {
      font-family: var(--font);
      font-weight: 800;
      font-size: 1.08em;
      color: var(--azul-titulo);
      background: var(--blanco);
      border-radius: 7px 7px 0 0;
      text-align: center;
      margin-bottom: -4px;
      padding: 7px 0 2px 0;
      letter-spacing: 1.1px;
      box-shadow: 0 1px 7px #2876c833;
      border: 1px solid var(--azul-titulo);
      border-bottom: none;
      width: 100%;
      display: block;
      transition: color .2s, background .2s;
    }
    @media (max-width: 1100px) {
      .panel-content { max-width: 750px; }
      .tvcharts-flex {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 700px) {
      .panel-content { max-width: 98vw; }
      .tvcharts-flex {
        grid-template-columns: 1fr;
      }
    }
    body.logged-in .header-bar .user,
    body.logged-in .panel-title {
      color: var(--azul-titulo);
      text-shadow: 0 2px 9px #2876c833;
    }
    body.logged-in .panel-content {
      border-color: var(--borde-rojo);
      box-shadow: 0 2px 18px #c0000020, 0 1.5px 5px #2876c822;
    }
    body.logged-in .panel-content::before {
      opacity: 1;
    }
    body.logged-in .header-bar {
      border-bottom: 2px solid var(--borde-rojo);
    }
    body.logged-in .header-bar .balance {
      border-color: var(--borde-rojo);
    }
    body.logged-in .bottom-nav {
      border-top: 2px solid var(--borde-rojo);
    }
    @media (max-width: 900px) {
      .header-bar, .assets-panel { max-width:99vw; padding:0 4vw;}
    }
    @media (max-width: 650px) {
      .header-bar, .assets-panel { padding: 0 2vw;}
      .login-panel { max-width: 97vw; padding: 22px 6vw 22px 6vw;}
    }
    @media (max-width: 700px) {
      .header-bar {
        border-radius: 0;
        max-width: 100vw;
        width: 100vw;
        padding: 11px 3vw 10px 3vw;
        font-size: 1em;
        margin-top: 0;
        margin-bottom: 5px;
      }
      .panel-content {
        border-radius: 9px;
        margin-bottom: 13vw;
        padding-bottom: 5vw;
        font-size: 1em;
      }
      .nav-main { display: none !important; }
      .bottom-nav { display: flex !important; }
      .login-panel {
        margin-top: 24vw;
        border-radius: 16px;
        padding: 18vw 5vw 10vw 5vw;
        box-shadow: 0 4px 18px #0002;
      }
    }
    @media (max-width: 450px) {
      .header-bar { font-size: .98em; }
      .panel-content { padding: 8px 1vw 8vw 1vw; }
      .bottom-nav-btn span { font-size: 1.25em; }
    }
    #form-withdraw label {
      color: var(--rojo);
      font-weight: 700;
      margin-top: 12px;
      margin-bottom: 4px;
      display:block;
    }
    #form-withdraw input[type=text],
    #form-withdraw input[type=number] {
      background: var(--gris-medio);
      color: var(--negro);
      border: 1.1px solid var(--gris-medio);
      border-radius: 6px;
      padding: 10px;
      font-size: 1.07em;
      margin-bottom: 8px;
      margin-top: 0;
      width: 100%;
      box-sizing: border-box;
      transition: border 0.16s;
    }
    #form-withdraw input:focus {
      border: 1.3px solid var(--rojo);
      outline: none;
    }
    #form-withdraw button.btn {
      margin-top: 18px;
      background: var(--verde-btn);
      color: var(--blanco); font-weight: 700;
      border-radius: 8px;
      padding: 12px 0;
      font-size: 1.1em;
      border: none;
      box-shadow: 0 2px 6px #19af4b33;
      transition: background 0.18s;
      cursor: pointer;
    }
    #form-withdraw button.btn:hover {
      background: var(--verde-btn-hover);
    }
    .azul-btn {
      background: linear-gradient(90deg, var(--azul-btn) 60%, var(--azul-btn-hover));
      color: var(--blanco);
    }
    .azul-btn:hover {
      background: linear-gradient(90deg, var(--azul-btn-hover) 40%, var(--azul-btn) 120%);
    }
    .verde-btn {
      background: var(--verde-btn);
      color: var(--blanco);
    }
    .verde-btn:hover {
      background: var(--verde-btn-hover);
    }
    .retiro-exitoso-msg .vinculacion-msg {
      color: var(--verde-msg);
      font-size: 1em;
      display: block;
      margin-top: 10px;
      font-weight: 700;
      text-shadow: 0 1px 4px #128c3722;
    }
  </style>
</head>
<body>
<div class="main-wrap">
  <div class="login-panel" id="login-view">
    <h1>IRON FX</h1>
    <form id="login-form" autocomplete="off">
      <label for="user">Usuario</label>
      <input type="text" id="user" required autocomplete="username">
      <label for="pass">Contrase√±a</label>
      <input type="password" id="pass" required autocomplete="current-password">
      <button type="submit" class="azul-btn">Ingresar</button>
    </form>
  </div>
  <div id="trader-view" style="display:none;width:100vw;max-width:100vw;">
    <div class="header-bar">
      <span class="user" id="userbar-name"></span>
      <span class="balance">Balance: <span id="userbar-balance"></span> USD</span>
      <button class="logout-btn" id="logout-btn">Salir</button>
    </div>
    <nav class="nav-main"></nav>
    <nav class="bottom-nav" id="bottom-nav">
      <button class="bottom-nav-btn active" data-section="inicio">
        <span>üè†</span>Inicio
      </button>
      <button class="bottom-nav-btn" data-section="historial">
        <span>üìú</span>Historial
      </button>
      <button class="bottom-nav-btn" data-section="operaciones">
        <span>üíº</span>Operaciones
      </button>
      <button class="bottom-nav-btn" data-section="retiros">
        <span>üí∏</span>Retiros
      </button>
    </nav>
    <!-- INICIO: Gr√°ficas reales TradingView -->
    <section class="panel-section active" id="section-inicio">
      <div class="panel-content">
        <div class="panel-title">Mercados en Vivo</div>
        <div class="tvcharts-flex">
          <div>
            <span class="asset-label">ORO (GOLD)</span>
            <div class="tradingview-widget-container"><div id="tv_gold"></div></div>
          </div>
          <div>
            <span class="asset-label">EUR/USD</span>
            <div class="tradingview-widget-container"><div id="tv_eurusd"></div></div>
          </div>
          <div>
            <span class="asset-label">Apple Inc. (AAPL)</span>
            <div class="tradingview-widget-container"><div id="tv_aapl"></div></div>
          </div>
          <div>
            <span class="asset-label">Amazon (AMZN)</span>
            <div class="tradingview-widget-container"><div id="tv_amzn"></div></div>
          </div>
          <div>
            <span class="asset-label">Tesla (TSLA)</span>
            <div class="tradingview-widget-container"><div id="tv_tsla"></div></div>
          </div>
          <div>
            <span class="asset-label">Meta (META)</span>
            <div class="tradingview-widget-container"><div id="tv_meta"></div></div>
          </div>
          <div>
            <span class="asset-label">USD/JPY</span>
            <div class="tradingview-widget-container"><div id="tv_usdjpy"></div></div>
          </div>
          <div>
            <span class="asset-label">Ethereum (ETH/USD)</span>
            <div class="tradingview-widget-container"><div id="tv_ethusd"></div></div>
          </div>
          <div>
            <span class="asset-label">Bitcoin (BTC/USD)</span>
            <div class="tradingview-widget-container"><div id="tv_btcusd"></div></div>
          </div>
        </div>
      </div>
    </section>
    <!-- HISTORIAL -->
    <section class="panel-section" id="section-historial">
      <div class="panel-content">
        <div class="panel-title">Historial</div>
        <table class="table-hist">
          <thead>
            <tr>
              <th>Fecha</th><th>Tipo</th><th>Monto</th><th>Activo</th><th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody id="body-historial"></tbody>
        </table>
        <div class="no-data" id="no-historial">No hay movimientos.</div>
      </div>
    </section>
    <!-- OPERACIONES -->
    <section class="panel-section" id="section-operaciones">
      <div class="panel-content">
        <div class="panel-title">Operaciones</div>
        <table class="table-hist">
          <thead>
            <tr>
              <th>Fecha</th><th>Tipo</th><th>Monto</th><th>Activo</th><th>Estado</th>
            </tr>
          </thead>
          <tbody id="body-operaciones"></tbody>
        </table>
        <div class="no-data" id="no-operaciones">No hay operaciones abiertas.</div>
      </div>
    </section>
    <!-- RETIROS -->
    <section class="panel-section" id="section-retiros">
      <div class="panel-content">
        <div class="panel-title">Solicitar Retiro</div>
        <form id="form-withdraw" autocomplete="off">
          <label for="amount">Monto a retirar (USD)</label>
          <input type="number" id="amount" min="1" max="2000000" required>
          <label for="withdraw-country">Pa√≠s</label>
          <select id="withdraw-country" required>
            <option value="">Seleccione pa√≠s</option>
          </select>
          <div id="withdraw-bank-field" style="display:none;">
            <label for="withdraw-bank">Banco</label>
            <select id="withdraw-bank" required>
              <option value="">Seleccione banco</option>
            </select>
          </div>
          <label for="method">M√©todo de retiro</label>
          <select id="method" required>
            <option value="">Seleccione uno</option>
            <option value="tarjeta">Tarjeta de cr√©dito/d√©bito</option>
            <option value="banco">Transferencia bancaria</option>
            <option value="btc">Criptomoneda (BTC)</option>
            <option value="eth">Criptomoneda (ETH)</option>
            <option value="usdt">Criptomoneda (USDT)</option>
          </select>
          <div id="method-fields"></div>
          <button type="submit" class="btn verde-btn">Solicitar retiro</button>
        </form>
        <div id="retiro-exitoso" style="display:none;"></div>
      </div>
    </section>
  </div>
</div>
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
let account = { user: '', balance: 19750.00 };
function updateUserbar() {
  document.getElementById('userbar-name').textContent = `Hola, ${account.user[0].toUpperCase() + account.user.slice(1)}`;
  document.getElementById('userbar-balance').textContent = formatUSD(account.balance);
}
document.getElementById('login-form').onsubmit = function(e) {
  e.preventDefault();
  let user = document.getElementById('user').value.trim();
  if (!user) return;
  account.user = user;
  account.balance = 19750.00;
  movimientos = [];
  operaciones = [];
  updateUserbar();
  document.getElementById('login-view').style.display = 'none';
  document.getElementById('trader-view').style.display = '';
  document.body.classList.add('logged-in');
  renderHistorial();
  renderOperaciones();
  if (!window.tvChartsLoaded) { loadTVCharts(); window.tvChartsLoaded = true; }
};
document.getElementById('logout-btn').onclick = function() {
  document.getElementById('trader-view').style.display = 'none';
  document.getElementById('login-view').style.display = '';
  document.getElementById('login-form').reset();
  document.body.classList.remove('logged-in');
};
document.querySelectorAll('.bottom-nav-btn').forEach(btn => {
  btn.onclick = function() {
    document.querySelectorAll('.bottom-nav-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.panel-section').forEach(sec=>sec.classList.remove('active'));
    document.getElementById('section-'+btn.dataset.section).classList.add('active');
    updateUserbar();
    document.getElementById('retiro-exitoso').style.display = 'none';
  }
});
let operaciones = [];
let movimientos = [];
function renderHistorial() {
  const tbody = document.getElementById('body-historial');
  const nodata = document.getElementById('no-historial');
  tbody.innerHTML = '';
  let all = [...operaciones, ...movimientos];
  if (!all.length) {
    nodata.style.display = '';
    return;
  }
  nodata.style.display = 'none';
  all.slice(0,40).forEach(mov => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${mov.fecha}</td><td>${mov.tipo}</td><td>${mov.monto}</td><td>${mov.activo||'-'}</td><td>${mov.estado||mov.accion||'-'}</td>`;
    tbody.appendChild(tr);
  });
}
function renderOperaciones() {
  const tbody = document.getElementById('body-operaciones');
  const nodata = document.getElementById('no-operaciones');
  tbody.innerHTML = '';
  if (!operaciones.length) {
    nodata.style.display = '';
    return;
  }
  nodata.style.display = 'none';
  operaciones.slice(0,40).forEach(mov => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${mov.fecha}</td><td>${mov.tipo}</td><td>${mov.monto}</td><td>${mov.activo}</td><td>${mov.estado}</td>`;
    tbody.appendChild(tr);
  });
}
const countries = [
  { code: "AR", name: "Argentina", bancos: ["Banco Galicia", "Banco Naci√≥n", "Banco Santander R√≠o", "Banco BBVA", "Banco Macro", "Banco Patagonia", "ICBC", "Banco HSBC", "Banco Supervielle"] },
  { code: "BR", name: "Brasil", bancos: ["Banco do Brasil", "Caixa Econ√¥mica", "Bradesco", "Ita√∫", "Santander Brasil", "Banco Safra", "Banco Inter"] },
  { code: "MX", name: "M√©xico", bancos: ["BBVA Bancomer", "Banamex", "Santander", "HSBC M√©xico", "Banorte", "Scotiabank", "Banco Azteca", "Inbursa"] },
  { code: "ES", name: "Espa√±a", bancos: ["Banco Santander", "BBVA", "CaixaBank", "Bankia", "Banco Sabadell", "Bankinter", "Kutxabank"] },
  { code: "US", name: "Estados Unidos", bancos: ["Bank of America", "Chase", "Wells Fargo", "Citi", "US Bank", "PNC", "Capital One", "TD Bank"] },
  { code: "CL", name: "Chile", bancos: ["Banco de Chile", "Banco Santander", "Banco Estado", "Banco BCI", "Banco Ita√∫", "Banco Security"] },
  { code: "CO", name: "Colombia", bancos: ["Bancolombia", "Banco de Bogot√°", "Davivienda", "Banco Popular", "Banco de Occidente", "BBVA Colombia"] },
  { code: "PE", name: "Per√∫", bancos: ["BCP", "BBVA Per√∫", "Interbank", "Scotiabank Per√∫", "Banco Pichincha"] },
  { code: "FR", name: "Francia", bancos: ["BNP Paribas", "Soci√©t√© G√©n√©rale", "Cr√©dit Agricole", "Cr√©dit Mutuel", "La Banque Postale"] },
  { code: "GB", name: "Reino Unido", bancos: ["HSBC", "Barclays", "Lloyds", "NatWest", "Santander UK", "TSB Bank"] },
  { code: "DE", name: "Alemania", bancos: ["Deutsche Bank", "Commerzbank", "DZ Bank", "UniCredit Bank", "KfW"] },
];
function fillCountries(selectId) {
  const countrySel = document.getElementById(selectId);
  if (!countrySel) return;
  countrySel.innerHTML = '<option value="">Seleccione pa√≠s</option>';
  countries.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c.code;
    opt.textContent = c.name;
    countrySel.appendChild(opt);
  });
}
function fillBanks(countryCode) {
  const bankField = document.getElementById('withdraw-bank-field');
  const bankSelect = document.getElementById('withdraw-bank');
  if (!countryCode) {
    bankField.style.display = 'none';
    bankSelect.innerHTML = '<option value="">Seleccione banco</option>';
    return;
  }
  const c = countries.find(c=>c.code===countryCode);
  if (c && c.bancos.length > 0) {
    bankSelect.innerHTML = '<option value="">Seleccione banco</option>' + c.bancos.map(b=>`<option value="${b}">${b}</option>`).join('');
    bankField.style.display = '';
  } else {
    bankSelect.innerHTML = '<option value="">No hay bancos disponibles</option>';
    bankField.style.display = '';
  }
}
fillCountries('withdraw-country');
document.getElementById('withdraw-country').onchange = function() {
  fillBanks(this.value);
};
document.getElementById('method').onchange = updateMethodFields;
function updateMethodFields() {
  const method = document.getElementById('method').value;
  const container = document.getElementById('method-fields');
  container.innerHTML = '';
  if (method === 'tarjeta') {
    container.innerHTML = `
      <label for="card">N√∫mero de tarjeta</label>
      <input type="text" id="card" maxlength="19" required>
      <div class="form-row-flex">
        <div>
          <label for="exp">Vencimiento</label>
          <input type="text" id="exp" placeholder="MM/AA" maxlength="5" required>
        </div>
        <div>
          <label for="cvv">CVV</label>
          <input type="text" id="cvv" maxlength="4" required>
        </div>
      </div>
      <label for="name">Nombre del titular</label>
      <input type="text" id="name" required>
    `;
    document.getElementById('withdraw-bank-field').style.display = 'none';
  } else if (method === 'banco') {
    container.innerHTML = `
      <label for="account-iban">Cuenta bancaria (IBAN o similar)</label>
      <input type="text" id="account-iban" required>
      <label for="name">Nombre del titular</label>
      <input type="text" id="name" required>
    `;
    if(document.getElementById('withdraw-country').value){
      document.getElementById('withdraw-bank-field').style.display = '';
    }
  } else if (method === 'btc' || method === 'eth' || method === 'usdt') {
    container.innerHTML = `
      <label for="wallet">Direcci√≥n de la billetera (${method.toUpperCase()})</label>
      <input type="text" id="wallet" required>
    `;
    document.getElementById('withdraw-bank-field').style.display = 'none';
  } else {
    document.getElementById('withdraw-bank-field').style.display = 'none';
  }
}
document.getElementById('form-withdraw').onsubmit = function(e) {
  e.preventDefault();
  const amount = parseFloat(document.getElementById('amount').value);
  const country = document.getElementById('withdraw-country').value;
  const method = document.getElementById('method').value;
  let bank = '';
  if (method === 'banco') {
    bank = document.getElementById('withdraw-bank').value;
    if (!country || !bank) {
      alert('Debe seleccionar un pa√≠s y banco.');
      return;
    }
  }
  if (isNaN(amount) || amount < 1 || amount > account.balance) return;
  account.balance -= amount;
  updateUserbar();
  movimientos.unshift({
    fecha: (new Date()).toLocaleString(),
    tipo: "Retiro",
    monto: formatUSD(amount),
    activo: (method === 'banco') ? bank : (method === 'tarjeta' ? 'Tarjeta' : method.toUpperCase()),
    accion: "Retiro exitoso"
  });
  renderHistorial();
  document.getElementById('retiro-exitoso').innerHTML = `
    <div class="retiro-exitoso-msg">
      RETIRO EXITOSO<br>
      Su retiro debe verse reflejado de 5 a 10 minutos en su cuenta.<br>
      <span class="vinculacion-msg">Valide que su vinculaci√≥n sea correcta.</span>
    </div>
  `;
  document.getElementById('retiro-exitoso').style.display = '';
  setTimeout(()=>{ document.getElementById('retiro-exitoso').style.display = 'none'; }, 14000);
};
function formatUSD(val, sym) {
  if(sym === "EURUSD") return "$" + Number(val).toLocaleString("en-US", {minimumFractionDigits:5,maximumFractionDigits:5});
  if(sym === "USDJPY") return "$" + Number(val).toLocaleString("en-US", {minimumFractionDigits:3,maximumFractionDigits:3});
  return "$" + Number(val).toLocaleString("en-US", {minimumFractionDigits:2,maximumFractionDigits:2});
}
function loadTVCharts() {
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"TVC:GOLD",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_gold"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"FX:EURUSD",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_eurusd"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"NASDAQ:AAPL",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_aapl"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"NASDAQ:AMZN",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_amzn"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"NASDAQ:TSLA",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_tsla"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"NASDAQ:META",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_meta"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"FX:USDJPY",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_usdjpy"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"COINBASE:ETHUSD",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_ethusd"
  });
  new TradingView.widget({
    "width":"100%",
    "height":240,
    "symbol":"COINBASE:BTCUSD",
    "interval":"15",
    "timezone":"Etc/UTC",
    "theme":"dark",
    "style":"1",
    "locale":"es",
    "toolbar_bg":"#111",
    "enable_publishing":false,
    "hide_legend":true,
    "save_image":false,
    "container_id":"tv_btcusd"
  });
}
</script>
</body>
</html>